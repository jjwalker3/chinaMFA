from bs4 import BeautifulSoup
from selenium import webdriver
import os
import psycopg2

def main():
    chrome_options = webdriver.ChromeOptions()
    chrome_options.add_argument('--headless')
    chrome_options.add_argument('--no-sandbox')
    chrome_options.add_argument('--disable-gpu')
    chrome_options.add_argument('--window-size=1280x1696')
    chrome_options.add_argument('--user-data-dir=/tmp/user-data')  #
    chrome_options.add_argument('--hide-scrollbars')
    chrome_options.add_argument('--enable-logging')
    chrome_options.add_argument('--log-level=0')
    chrome_options.add_argument('--v=99')
    chrome_options.add_argument('--single-process')  #
    chrome_options.add_argument('--data-path=/tmp/data-path')  #
    chrome_options.add_argument('--ignore-certificate-errors')
    chrome_options.add_argument('--homedir=/tmp')  #
    chrome_options.add_argument('--disk-cache-dir=/tmp/cache-dir')  #
    chrome_options.add_argument('user-agent=Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36')
    chrome_options.binary_location = os.getcwd() + "/bin/headless-chromium"  #
    
    driver = webdriver.Chrome(options=chrome_options, executable_path="chromedriver.exe")
    driver = webdriver.Chrome(executable_path="chromedriver.exe")  #
    
    driver.get("https://www.bbc.com/news")
    html = driver.page_source
    soup=BeautifulSoup(html, 'lxml')
    pageText = soup.find(class_='gs-c-promo-heading gs-o-faux-block-link__overlay-link gel-paragon-bold nw-o-link-split__anchor').text
    
    
    conn = psycopg2.connect(host="dbtest123.cofdbub8go3o.eu-west-1.rds.amazonaws.com",
                        database="dbtestname",
                        user="tokyo6",
                        password="shinjiikari")

    cur = conn.cursor()

    command = """
    INSERT INTO testtable(content,datetime)
    VALUES(%s,current_timestamp);
    """
    

    cur.execute(command,(pageText,))
    conn.commit()

    cur.close()
    conn.close()
